---
title: 智能信息-鸿蒙开发工程师-夸克-广州
icon: /assets/icons/article.svg
order: 2
category:
  - Interview
  - C++
  - Quark
---

夸克的面试明显比美团难多了，非常底层的问题，由于我的项目里面提到了网络协议，`Binder`机制、没想到这个团队就是做这些的，听面试官讲，这个部门主要是做网络库封装，`arkts`到移动端的`native binding`能力，程序冷启动优化等业务。面试官疯狂提问，有些东西都太久远了，我都快记不得了😒😒😒

## 岗位介绍

负麦夸克鸿蒙/安卓客户端核心功能模块的设计与开发，保障业务性能与稳定性。
优化鸿蒙移动端用户体验，通过技术手段提升交互流畅度与资源利用率。参与技术基础设施建设，推动研发流程标准化与工具链优化。
**岗位要求**

- 一年以上工作经验，计算机基础扎实，熟悉数据结构和算法，在网络编程，多线程，操作系统方面有较深的知识掌握和实践经验,
- 孰练掌握鸿蒙/安卓系统开发技术栈(如`ArKTS`/`Java`)或前端开发流程，有中大型移动端项目经验优先熟悉移动端性能调优及其原理(内存管理、渲染优化等)，能解决复杂技术问题。
- 技术视野开阔，关注行业趋势，具备新技术调研与落地能力。沟通协作能力强，能在跨团队合作中高效推动技术方案落地。

## 一、介绍项目

个人介绍，工作经历介绍，项目介绍等，开始暖场。

## 二 、围绕项目使用的技术进行提问

### **网络协议相关**

#### **`SSH`协议如何保证安全的(主要是讲身份验证的方式和过程)；**

::: details 查看答案

SSH协议网上有很多讲解的，这里不再赘述，我猜面试官应该是想让我简答一下SSH保证安全性的核心机制。首先，SSH是一种用于在不安全，不受信任的网络上进行远程shell会话，或者用于执行文件传输动作的安全通信协议。是介于传输层和应用层之间的一种安全协议。

首先，我们来看下**SSH的整体会话流程**：

1. **TCP连接建立**：客户端连接服务器的22端口，建立TCP连接。
2. **协议版本交换**：双方交换SSH版本信息，确保兼容性（通常使用SSH-2）。
3. **密钥交换**：使用Diffie-Hellman（DH）算法生成共享对称密钥，用于后续加密。同时协商加密算法、哈希算法和压缩方法。
4. **服务器身份验证**：服务器发送其主机公钥（通常RSA、DSA或ECDSA）。客户端检查公钥指纹是否匹配本地known_hosts文件。如果是首次连接，客户端提示用户手动验证指纹并添加到known_hosts中，防止MITM攻击。
5. **客户端身份验证**：服务器根据配置要求客户端进行认证（详见下文）。
6. **会话建立**：认证成功后，建立加密通道，用于命令执行或文件传输。
7. **数据传输**：所有数据使用共享密钥加密，并附加MAC（Message Authentication Code）确保完整性。

从上面的流程，我们可以看到，安全机制主要体现在SSH会话建立过程和数据传输过程，身份验证是一个双向的验证过程，其次会话阶段的数据传输也使用对称加密的方式，让实际在中间网络中报文都是密文的格式。

**SSH支持多种客户端身份验证方法**，由服务器配置决定，这些方法可以组合使用（如密码+公钥），或按优先级顺序尝试。常见方法如下表所示：

| 方法名称                            | 描述                                                         | 安全性评估               | 适用场景               |
| ----------------------------------- | ------------------------------------------------------------ | ------------------------ | ---------------------- |
| 密码认证 (Password)                 | 客户端输入用户名和密码，加密后发送给服务器验证。             | 中等（易受暴力破解影响） | 简单用户登录           |
| 公钥认证 (Public Key)               | 使用公钥-私钥对：客户端用私钥签名挑战，服务器用公钥验证。    | 高（私钥不传输）         | 自动化脚本、管理员访问 |
| 主机-based认证 (Host-based)         | 基于客户端主机名/IP，使用shosts.equiv文件验证，无需密码。    | 低（易伪造IP）           | 封闭网络内部           |
| 键盘交互认证 (Keyboard-Interactive) | 服务器发送多个提示（如密码或挑战），客户端响应，支持PAM模块。 | 中等至高（可集成多因素） | 需要额外验证的场景     |
| GSSAPI/Kerberos认证                 | 使用Kerberos票据进行单点登录，无需密码。                     | 高（集成企业级认证系统） | 大型企业环境           |
| 挑战响应认证 (Challenge-Response)   | 与键盘交互类似，由后端系统发送挑战并验证响应。               | 中等（依赖后端安全性）   | PAM集成认证            |

:::

#### 网络中报文如何保证传输安全，用到的加密技术有哪些？

::: details 查看答案

确保网络中的报文传输安全是一个系统工程，主要体现在以下方面：

1. 身份认证
2. 密文传输
3. 报文完整性保证

**身份认证技术**: 通过数字证书与公钥基础设施(PKI)来保证，

- **数字证书：** 由受信任的第三方机构`数字证书颁发机构`签发的电子文档，将实体的身份信息（如域名、公司名）与其公钥绑定。证书本身包含持有者的公钥和 CA 的数字签名；
- **CA (Certificate Authority)：** 可信任的第三方机构，负责核实证书申请者的身份并签发证书；
- **链式信任：** 根 CA -> 中间 CA -> 服务器证书。客户端（如浏览器）内置信任的根 CA 列表。通过验证证书链上所有 CA 的签名，最终信任服务器证书中的公钥确实属于它声明的实体；
- **应用：** TLS/SSL 握手开始时，服务器将其证书发送给客户端，客户端验证证书的有效性（包括是否由可信 CA 签发、是否在有效期内、是否匹配访问的域名等）。客户端也可以提供证书供服务器验证（双向认证，较少用于普通 web 访问）；

**密文传输技术**:  主要是通过加密算法实现，加密方式又可以分为对称加密和非对称加密。

- **对称加密：** 加密和解密使用同一个密钥。优点是速度快，适合加密大量数据，比如常见的`AES`算法；
- **非对称加密 (公钥加密)**：使用一对密钥，公钥 (公开) 和私钥 (保密)。用公钥加密的数据只能用对应的私钥解密，反之亦然。优点是密钥分发方便，解决了对称加密的密钥交换问题，但速度慢得多，常见算法有`RSA`, `ECC`, `DSA`等等。
- **应用：** 主要用于两个关键环节：•**密钥协商/交换：** 在对称加密会话开始前，安全地协商出一个临时的对称会话密钥（如使用 Diffie-Hellman 及其变种）。•**数字签名：** 用于身份认证和确保完整性/抗抵赖性。

**报文完整性保证**：发送方使用自己的`私钥`对特定数据（如原始报文或报文的哈希值）进行加密，生成签名，接收方使用发送方的`公钥`（通常来自证书）解密该签名，并将解密结果与自己对原始数据计算的哈希值进行比对。匹配则证明数据未被篡改且确实来自声称的发送方。例如，在TLS协议中，`HMAC`用于验证报文在已建立的加密通道中的完整性。

:::

#### 网络数据传输过程中出现公共网络丢包的情况，如何定位和分析，并如何做好优化

::: details 查看答案

**丢包节点定位：**
如果出现丢包的话，首先要找到发生丢包的节点，常见的方式可以使用ICMP工具(ping, trace)查看网络的传输质量和对报文的传输路径进行追踪，或者使用更高阶的工具`mtr`, 实时显示路径中每一跳的丢包率(结合 traceroute + ping)，比 `ping` 更精准。

个人感觉面试官这里问的优化应该是应用侧能做哪些优化？首先如果是对于TCP协议本身，如果丢包引发多次重传，TCP有自己的流控机制(拥塞控制)，如果是对接收端的优化，可以调整接收端的报文缓冲区大小或者缓存队列的大小。

:::

#### 你项目里面讲了你把传输性能提高了一倍，能讲讲你具体做了哪些优化工作吗；

::: details 查看答案

个人的工作主要是通信协议代码的优化，个人在工作中主要是使用用了内存池技术，减少频繁去为收发上来的报文申请缓冲区，其次，合理化报文分片大小，比如通过Socket选项设置TCP的MSS选项配置，尽量使得发送的数据包更大一些，减少传输层分片的数量。

:::

#### 对于比较大的业务报文中间的某些小包发生丢失，如何实现一种手段保证重传效率

::: details 查看详情

感觉面试官这里是想引出`QUIC`协议栈，但是我不是很了解，另外面试官提到了有没有什么恢复算法，我这里也没答上来，我初步了解了下，主要有以下技术：

1. 应用层执行更加精细的分片，能够让发送端进行选择性的重传；
2. 前向纠错预保护技术(**F**orward **E**rror **C**orrection, 简称FEC)，这是一种**预先添加冗余信息**来纠正传输过程中数据错误的技术。其核心思想是：在发送端对原始数据做特殊编码，生成额外的校验数据包，接收端收到部分数据后，可通过算法自动恢复丢失或损坏的数据包，**无需请求发送方重传**。
3. 协议层优化，比如使用QUIC协议层，QUIC协议层自带以下技术保证
    - **零RTT重传**：缓存分片信息，重传直接触发
    - **独立包序**：消除TCP队头阻塞
    - **内置FEC**：QUIC草案支持`RaptorQ`编码
4. 另外还有一些系统调优技术，比如对Linux的内核参数进行调优，启动Linux的SACK技术等等，还需要好好了解，太多底层优化技术了。

:::

#### 知道哪些基于`udp`实现的协议吗，比如`quic`协议栈，了解吗，详细讲讲？

### Socket编程相关

#### 讲一下libevent库

你提到了`libevent`库，你了解它的核心机制吗(我提到了IO多路复用，面试官顺势就提到了`epoll`)；

1. 你了解`epoll`吗，`epoll`的使用方式，`epoll`监听事件的底层机制你知道吗？

1. **IPC相关和进程启动**
    1. 你讲到了你熟悉`binder`，能将一下`binder`的原理吗，整个`binder`调用的整体流程是啥，`binder`的性能优化，相对于传统的`ipc`调用在数据上的性能体现是怎么样的，比如优化了多少倍？；
    2. 由于进程的冷启动，我的`binder`发起的请求响应很慢，你能提一下大概有哪些原因，如何优化这个调用时延；

2. **内存相关**
    1. 你讲一下堆和栈的区别；
    2. 什么情况下会栈溢出;
    3. 如何定位堆破坏的问题，有哪些手段，在生产环境上如何定位；
    4. 一般栈的大小是多少，M？K？一个栈帧的内容是啥，有多大？

3. **`gdb`的使用**
    1. 如何查看堆栈调用信息；
    2. 如何查看寄存器信息；
    3. 如何查看内存信息，内存打印的命令和方式；

4. **`linux shell`的使用**

    1. 如何判断`shell`命令的返回值；
    2. 查看`cpu`架构的命令是啥；

5. **其余问题**

    1. 你业务针对于大量窗口和应用的并发请求，如何保证没问题的；
    2. 一个任务的执行出现阻塞，使用哪些分析可以分析整个线程阻塞在哪里；
    3. 一个任务的调度不符合预期，部分执行耗时长，使用哪些手段可以进行分析；
    4. 我看你工作转身挺大的，从网络协议栈到C端操作系统，讲讲你怎么适应和胜任工作的；
    5. 我的一个机器内存非常小，比如只有几十M，然后我要对一个TB的数据进行排序，如何实现

## 3 C++基础知识

1. 讲一下C++的智能指针，有哪些，具体怎么实现；
2. `unique_ptr` 的实现原理，如果你要自己实现，有哪些关键的函数；
3. `unique_ptr` 的移动赋值如何保证原先的对象管理的内存不会变为野指针；
4. `weak_ptr`如何保证访问资源时，保证资源是有效的而不是野指针；

## 4 笔试题

使用十个线程，并发对一个int变量加100次，并将结果放入到传入的vector中，我开始实现了一个使用锁的版本

，然后面试官又让实现一个**无锁版本**；

```c++
// 函数原型如下
void concurrent_add(int* N, vector<int>* result) {
 
}
```
