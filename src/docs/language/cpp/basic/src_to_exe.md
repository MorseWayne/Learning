---
title: 编译过程详解
icon: /assets/icons/article.svg
order: 1
category:
  - C++
---

## 1. Overview

编译就是将C++源代码转换为机器可以理解的格式的一个过程。对于计算机来说，它只能理解二进制编码，C++的源代码只是为了方便人类理解(`human-readable`)。所以, 为了让机器理解我们的代码，我们需要一个“翻译官”，也就是我们常说的编译器(`Compiler`), 编译器的工作就是将源代码转换机器语言，编译的过程也就是一个“翻译”的过程.
一个完整的编译过程主要分为以下四个阶段：

| 阶段 | 步骤名称                       | 输入                                 | 主要处理内容                                    | 输出                      |
| -- | -------------------------- | ---------------------------------- | ----------------------------------------- | ----------------------- |
| 1  | **预处理**<br>(Preprocessing) | C/C++ 源文件<br>(.c/.cpp, .h/.hpp)    | 移除注释、展开宏、处理 `#include`、执行条件编译，生成无预处理指令的源码 | 预处理文件<br>(.i / .ii)     |
| 2  | **编译**<br>(Compilation)    | 预处理文件<br>(.i / .ii)                | 词法分析、语法分析、语义分析、优化代码，生成对应的汇编代码             | 汇编文件<br>(.s / .asm)     |
| 3  | **汇编**<br>(Assembly)       | 汇编文件<br>(.s / .asm)                | 将汇编指令翻译为机器码，生成可重定位的目标文件                   | 目标文件<br>(.o / .obj)     |
| 4  | **链接**<br>(Linking)        | 目标文件与库文件<br>(.o / .obj, .lib / .a) | 合并多个目标文件与库，解决符号引用，生成完整的可执行程序              | 可执行文件<br>(.exe / a.out) |

::: tip

**Compilation** 这个词在C++语境下，既可以指代从源代码到可执行文件的整个完整过程，也可以特指其中“将代码翻译成汇编”这一个核心步骤，请注意区分。

:::

## 2. 编译过程详解

### 2.1 预处理（Preprocessing）

编译过程的第一阶段，主要包含了以下动作：

| 阶段 | 步骤                    | 主要作用                                            | 示例                                           |
| ---- | ----------------------- | --------------------------------------------------- | ---------------------------------------------- |
| 1    | Comments removal        | 删除 `//` 和 `/*...*/` 中的注释内容，只保留有效代码 | `int a=1; // 变量` → `int a=1;`                |
| 2    | Macros expansion        | 将 `#define` 定义的宏替换为实际内容                 | `#define PI 3.14` → `area=3.14*r*r;`           |
| 3    | File inclusion          | 将 `#include` 引用的头文件内容直接插入到代码中      | `#include <stdio.h>` → 插入 `stdio.h` 文件内容 |
| 4    | Conditional compilation | 根据条件指令选择性保留或删除代码                    | `#ifdef DEBUG` 包含调试代码，否则移除          |
